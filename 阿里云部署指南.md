# å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ - é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å—

## å‰ææ¡ä»¶

1. å·²è´­ä¹°é˜¿é‡Œäº‘ECSæœåŠ¡å™¨ï¼ˆæ¨èé…ç½®ï¼š2æ ¸4Gï¼ŒCentOS 7.xæˆ–Ubuntu 20.04ï¼‰
2. å·²æœ‰æœåŠ¡å™¨å…¬ç½‘IP
3. å·²å¤‡æ¡ˆåŸŸåï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨IPè®¿é—®ï¼‰

---

## ç¬¬ä¸€æ­¥ï¼šè¿æ¥æœåŠ¡å™¨

### Windowsç”¨æˆ·
ä½¿ç”¨PuTTYæˆ–Xshellè¿æ¥ï¼š
- ä¸»æœºï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘IP
- ç«¯å£ï¼š22
- ç”¨æˆ·åï¼šroot
- å¯†ç ï¼šè´­ä¹°æœåŠ¡å™¨æ—¶è®¾ç½®çš„å¯†ç 

### æˆ–ä½¿ç”¨é˜¿é‡Œäº‘æ§åˆ¶å°
ç™»å½•é˜¿é‡Œäº‘ â†’ ECS â†’ å®ä¾‹ â†’ è¿œç¨‹è¿æ¥

---

## ç¬¬äºŒæ­¥ï¼šå®‰è£…ç¯å¢ƒ

### 1. æ›´æ–°ç³»ç»Ÿ
```bash
yum update -y  # CentOS
# æˆ–
apt update && apt upgrade -y  # Ubuntu
```

### 2. å®‰è£…Node.js
```bash
# å®‰è£…nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc

# å®‰è£…Node.js 20
nvm install 20
nvm use 20
node -v  # éªŒè¯å®‰è£…
```

### 3. å®‰è£…MySQL
```bash
# CentOS
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
rpm -ivh mysql80-community-release-el7-3.noarch.rpm
yum install mysql-server -y
systemctl start mysqld
systemctl enable mysqld

# Ubuntu
apt install mysql-server -y
systemctl start mysql
systemctl enable mysql
```

### 4. é…ç½®MySQL
```bash
# è·å–ä¸´æ—¶å¯†ç ï¼ˆCentOSï¼‰
grep 'temporary password' /var/log/mysqld.log

# ç™»å½•MySQL
mysql -u root -p

# ä¿®æ”¹å¯†ç å¹¶åˆ›å»ºæ•°æ®åº“
ALTER USER 'root'@'localhost' IDENTIFIED BY 'ä½ çš„æ–°å¯†ç ';
CREATE DATABASE student_management CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
exit;
```

### 5. å®‰è£…Nginx
```bash
# CentOS
yum install nginx -y

# Ubuntu
apt install nginx -y

# å¯åŠ¨Nginx
systemctl start nginx
systemctl enable nginx
```

### 6. å®‰è£…PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
```bash
npm install -g pm2
```

---

## ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

### æ–¹æ³•1ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www
git clone ä½ çš„é¡¹ç›®ä»“åº“åœ°å€
cd student-management-system
```

### æ–¹æ³•2ï¼šä½¿ç”¨FTPå·¥å…·
ä½¿ç”¨FileZillaæˆ–WinSCPä¸Šä¼ é¡¹ç›®æ–‡ä»¶åˆ° `/var/www/student-management-system`

### æ–¹æ³•3ï¼šä½¿ç”¨SCPå‘½ä»¤
åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼š
```bash
scp -r E:\develop\é¡¹ç›®\administration\student-management-system root@ä½ çš„æœåŠ¡å™¨IP:/var/www/
```

---

## ç¬¬å››æ­¥ï¼šé…ç½®åç«¯

### 1. è¿›å…¥åç«¯ç›®å½•
```bash
cd /var/www/student-management-system/server
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. ä¿®æ”¹ç¯å¢ƒé…ç½®
```bash
vi .env
```

ä¿®æ”¹ä¸ºï¼š
```env
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=ä½ çš„MySQLå¯†ç 
DB_NAME=student_management
JWT_SECRET=your-secret-key-change-this-in-production
PORT=3001
```

æŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¿®æ”¹å®ŒåæŒ‰ `ESC`ï¼Œè¾“å…¥ `:wq` ä¿å­˜é€€å‡º

### 4. å¯¼å…¥æ•°æ®åº“
```bash
mysql -u root -p student_management < /var/www/student-management-system/database-mysql.sql
```

### 5. å¯åŠ¨åç«¯æœåŠ¡
```bash
pm2 start index.js --name student-api
pm2 save
pm2 startup
```

### 6. éªŒè¯åç«¯
```bash
curl http://localhost:3001/api
```

---

## ç¬¬äº”æ­¥ï¼šé…ç½®å‰ç«¯

### 1. ä¿®æ”¹APIåœ°å€
```bash
cd /var/www/student-management-system
vi src/utils/request.js
```

ä¿®æ”¹baseURLä¸ºï¼š
```javascript
const request = axios.create({
  baseURL: 'http://ä½ çš„æœåŠ¡å™¨IP:3001/api',  // æ”¹æˆæœåŠ¡å™¨IP
  timeout: 10000
})
```

### 2. æ„å»ºå‰ç«¯
```bash
npm install
npm run build
```

æ„å»ºå®Œæˆåä¼šç”Ÿæˆ `dist` æ–‡ä»¶å¤¹

---

## ç¬¬å…­æ­¥ï¼šé…ç½®Nginx

### 1. åˆ›å»ºNginxé…ç½®
```bash
vi /etc/nginx/conf.d/student-management.conf
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name ä½ çš„æœåŠ¡å™¨IP;  # æˆ–åŸŸå

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/student-management-system/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### 2. æµ‹è¯•å¹¶é‡å¯Nginx
```bash
nginx -t  # æµ‹è¯•é…ç½®
systemctl restart nginx
```

---

## ç¬¬ä¸ƒæ­¥ï¼šé…ç½®é˜²ç«å¢™

### å¼€æ”¾ç«¯å£
```bash
# CentOS
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=3001/tcp
firewall-cmd --reload

# Ubuntu
ufw allow 80/tcp
ufw allow 3001/tcp
ufw reload
```

### é˜¿é‡Œäº‘å®‰å…¨ç»„
1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. ECS â†’ ç½‘ç»œä¸å®‰å…¨ â†’ å®‰å…¨ç»„
3. é…ç½®è§„åˆ™ â†’ æ·»åŠ å®‰å…¨ç»„è§„åˆ™
4. å¼€æ”¾ç«¯å£ï¼š80ã€3001

---

## ç¬¬å…«æ­¥ï¼šè®¿é—®é¡¹ç›®

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
http://ä½ çš„æœåŠ¡å™¨IP
```

åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢äº†ï¼

---

## å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹åç«¯æ—¥å¿—
```bash
pm2 logs student-api
```

### é‡å¯åç«¯
```bash
pm2 restart student-api
```

### åœæ­¢åç«¯
```bash
pm2 stop student-api
```

### æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
```bash
pm2 status
```

### é‡å¯Nginx
```bash
systemctl restart nginx
```

### æŸ¥çœ‹Nginxæ—¥å¿—
```bash
tail -f /var/log/nginx/error.log
```

---

## å¯é€‰ï¼šé…ç½®HTTPSï¼ˆä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦ï¼‰

### 1. å®‰è£…Certbot
```bash
# CentOS
yum install certbot python3-certbot-nginx -y

# Ubuntu
apt install certbot python3-certbot-nginx -y
```

### 2. è·å–è¯ä¹¦
```bash
certbot --nginx -d ä½ çš„åŸŸå
```

### 3. è‡ªåŠ¨ç»­æœŸ
```bash
certbot renew --dry-run
```

---

## æ•…éšœæ’æŸ¥

### 1. åç«¯æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs student-api

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tunlp | grep 3001

# æ£€æŸ¥MySQLè¿æ¥
mysql -u root -p
```

### 2. å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx

# æ£€æŸ¥Nginxé…ç½®
nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ `server/.env` é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥MySQLæ˜¯å¦å¯åŠ¨ï¼š`systemctl status mysqld`
- æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨ï¼š`mysql -u root -p -e "SHOW DATABASES;"`

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨Gzipå‹ç¼©**ï¼ˆåœ¨Nginxé…ç½®ä¸­æ·»åŠ ï¼‰
2. **é…ç½®é™æ€èµ„æºç¼“å­˜**
3. **ä½¿ç”¨CDNåŠ é€Ÿ**
4. **æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**
5. **å®šæœŸå¤‡ä»½æ•°æ®åº“**

---

## å¤‡ä»½è„šæœ¬

åˆ›å»ºè‡ªåŠ¨å¤‡ä»½è„šæœ¬ï¼š
```bash
vi /root/backup.sh
```

å†…å®¹ï¼š
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u root -pä½ çš„å¯†ç  student_management > /root/backups/db_$DATE.sql
# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find /root/backups -name "db_*.sql" -mtime +7 -delete
```

è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š
```bash
chmod +x /root/backup.sh
crontab -e
# æ·»åŠ ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /root/backup.sh
```

---

## å®Œæˆï¼

ç°åœ¨ä½ çš„å­¦ç”Ÿç®¡ç†ç³»ç»Ÿå·²ç»æˆåŠŸéƒ¨ç½²åˆ°é˜¿é‡Œäº‘äº†ï¼ğŸ‰

è®¿é—®åœ°å€ï¼š`http://ä½ çš„æœåŠ¡å™¨IP`
